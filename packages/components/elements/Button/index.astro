---
import clsx from "clsx";
import Icon from "../Icon/index.astro";
import { buttonSchema } from "./schema";
const props = buttonSchema.parse(Astro.props);

const {
  label,
  link,
  iconName,
  iconPosition,
  iconDisplay,

  type,
  size,
  layout,
  outline,

  id,
  className,
  customStyle,

  ariaLabel,
  ariaDescribedby,
  ariaControls,
  ariaExpanded,
  disabled,
} = props;

const iconOnly = iconDisplay === "icon_only";
const hasIcon = Boolean(iconName);

const classAttr = clsx(
  "button",
  className,
  iconOnly && "icon",
  type,
  `size-${size}`,
  layout,
  outline && "outline"
);

const commonProps = {
  class: classAttr,
  ...(customStyle ? { style: customStyle } : {}),
  ...(id ? { id } : {}),
  ...(ariaLabel ? { "aria-label": ariaLabel } : {}),
  ...(ariaDescribedby ? { "aria-describedby": ariaDescribedby } : {}),
  ...(ariaControls ? { "aria-controls": ariaControls } : {}),
  ...(ariaExpanded !== undefined ? { "aria-expanded": ariaExpanded } : {}),
  ...(disabled ? { disabled } : {}),
};
---

<style is:global>
  @import "./theme.light.css";
  @import "./theme.dark.css";
</style>

<style>
  @import "./styles.css";
</style>

{
  () => {
    const contents = (
      <>
        {hasIcon && iconPosition === "before" && (
          <Icon name={iconName} buttonIcon={true} size="none" />
        )}
        {iconOnly && label && <span class="sr-only">{label}</span>}
        {!iconOnly && label && <span>{label}</span>}
        {hasIcon && iconPosition === "after" && (
          <Icon name={iconName} buttonIcon={true} size="none" />
        )}
      </>
    );

    return link ? (
      <a href={link} role="button" {...commonProps}>
        {contents}
      </a>
    ) : (
      <button type="button" {...commonProps}>
        {contents}
      </button>
    );
  }
}
