---
import clsx from "clsx";
import Icon from "../../elements/icon/icon.astro";
import RenderBlock from "../../utils/renderBlock.astro";

const { items, openFirst, ...rest } = Astro.props;

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => !key.startsWith("_"))
);

const classNames = clsx("accordion");
---

<div class:list={classNames} {...htmlAttributes}>
  {
    items.map((item: any, index: number) => {
      const isFirst = index === 0 && openFirst;

      return (
        <details name="test" class="item" open={isFirst}>
          <summary class="title">
            <span class="text">{item.title}</span>
            <Icon name="chevron-up" size="none" />
          </summary>
          <div class="detail">
            <RenderBlock contentBlocks={item.content_blocks} />
          </div>
        </details>
      );
    })
  }
</div>

<style>
  .accordion {
    > .item {
      border-bottom: 1px solid var(--color-border-subtle);

      > .title {
        align-items: center;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        padding: var(--space-md);
        font-size: var(--font-size-xl);
        font-weight: var(--font-weight-bold);
        transition: background-color var(--animation-normal) ease-out;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;

        &:first-of-type {
          list-style-type: none;
        }

        &:hover {
          background-color: var(--color-bg-surface);
        }

        &::-webkit-details-marker {
          display: none;
        }

        .icon {
          transition: transform var(--animation-normal) ease-out;
        }
      }

      > .detail {
        padding-inline: var(--space-md);
      }
    }

    > .item[open] {
      > .title .icon {
        transform: rotate(180deg);
      }

      > .detail {
        animation: grow-out 300ms ease-out;
      }
    }
  }
</style>
